<!DOCTYPE html>
{% extends "sistemainventario/base.html" %}
{% load static %}
{% comment %} <html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block title %}
    <title>Inventario</title>
    {% endblock title %}
    <link rel="icon" type="image/png" href="{% static 'logoMundoCartas.png' %}">
    <style>
        .table-container { width: 100%; border: 1px solid #ccc; }
        .header-row { display: flex; background-color: #f0f0f0; font-weight: bold; padding: 10px; }
        .header-row div { flex: 1; text-align: center; }
        .product-row { display: flex; border-top: 1px solid #ccc; padding: 10px; }
        .product-row div { flex: 1; text-align: center; }
    </style>
</head> {% endcomment %}
{% block title %}
<title>Inventario</title>
{% endblock title %}
<body>
    {% block content %}
    
    {% comment %} <h1>{{ titulo }}</h1>
    <p>Productos de la tienda Mundo Cartas.</p> {% endcomment %}
    <div class="container">
      <!-- T√≠tulo de la p√°gina -->
      <div class="text-center mt-5">
        <h1>{{ titulo }}</h1>
        <p class="lead">
          Stock de productos de la tienda Mundo Cartas.
        </p>
      </div>
      
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- MENSAJES (success, error, warning, info) - POSICI√ìN FIJA -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      {% if messages %}
        <div style="position: fixed; top: 80px; right: 20px; z-index: 9999; max-width: 400px;">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-lg" role="alert">
              <strong>‚úì</strong> {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <!-- BOTONES DE ADMINISTRACI√ìN (Solo para administradores) -->
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      {% if request.user.usuario.rol == 'administrador' %}
        <div class="mb-4 text-end">
          <a href="{% url 'crear_producto' %}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Nuevo Producto
          </a>
          <a href="{% url 'crear_categoria' %}" class="btn btn-info">
            <i class="bi bi-plus-circle"></i> Nueva Categor√≠a
          </a>
          <a href="{% url 'crear_proveedor' %}" class="btn btn-warning">
            <i class="bi bi-plus-circle"></i> Nuevo Proveedor
          </a>
        </div>
      {% endif %}
    
    <div class="table-responsive">
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>Nombre</th>
            <th>Categor√≠a</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for producto in productos %}
          <tr>
            <td>{{ producto.nombre }}</td>
            <td>{{ producto.categoria.nombre }}</td>
            <td>${{ producto.precio }}</td>
            <td>{{ producto.stock }}</td>
            <td>
              {% if producto.stock == 0 %}
                <span class="badge bg-danger">Sin stock</span>
              {% elif producto.stock <= producto.stock_minimo %}
                <span class="badge bg-warning text-dark">Stock bajo</span>
              {% else %}
                <span class="badge bg-success">Con stock</span>
              {% endif %}
            </td>
            <td>
              <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
              <!-- BOT√ìN AGREGAR AL CARRITO -->
              <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
              {% if producto.stock > 0 %}
                <!-- Si hay stock disponible, mostrar bot√≥n activo -->
                <a href="{% url 'agregar_carrito' producto.id %}" class="btn btn-success btn-sm">
                  üõí Agregar
                </a>
              {% else %}
                <!-- Si NO hay stock, mostrar bot√≥n deshabilitado -->
                <button class="btn btn-secondary btn-sm" disabled>
                  Sin stock
                </button>
              {% endif %}
              
              <!--
                Bot√≥n "Ver detalles":
                - data-bs-toggle="modal" y data-bs-target="#detalleModal" hacen que Bootstrap abra el modal con id "detalleModal" al hacer clic.
                - Los atributos data-* (data-id, data-nombre, etc.) almacenan los datos del producto.
                - Estos datos ser√°n le√≠dos por el script JS para llenar el modal din√°micamente.
              -->
              <a href="#" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#detalleModal"
                 data-id="{{ producto.id }}"
                 data-nombre="{{ producto.nombre }}"
                 data-descripcion="{{ producto.descripcion }}"
                 data-precio="{{ producto.precio }}"
                 data-stock="{{ producto.stock }}"
                 data-stock_minimo="{{ producto.stock_minimo }}"
                 data-fecha_creacion="{{ producto.fecha_creacion|date:'Y-m-d H:i' }}"
                 data-fecha_modificacion="{{ producto.fecha_modificacion|date:'Y-m-d H:i' }}"
                 data-categoria="{{ producto.categoria.nombre }}"
                 data-proveedores="{% for proveedor in producto.proveedores.all %}{{ proveedor.nombre }}{% if not forloop.last %}, {% endif %}{% endfor %}">
                Ver detalles
              </a>
              
              <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
              <!-- BOTONES DE MODIFICAR Y ELIMINAR (Solo para administradores) -->
              <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
              {% if request.user.usuario.rol == 'administrador' %}
                <a href="{% url 'editar_producto' producto.id %}" class="btn btn-warning btn-sm">Modificar</a>
                <a href="{% url 'eliminar_producto' producto.id %}" class="btn btn-danger btn-sm">Eliminar</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!--
      Modal Bootstrap para mostrar detalles del producto seleccionado.
      - El modal tiene el id "detalleModal" y se abre autom√°ticamente por Bootstrap cuando un bot√≥n con data-bs-toggle="modal" y data-bs-target="#detalleModal" es clickeado.
      - Cada <span id="detalle-..."></span> ser√° llenado din√°micamente por el script JS con los datos del producto.
    -->
    <div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detalleModalLabel">Detalles del Producto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <ul class="list-group">
              <li class="list-group-item"><strong>ID:</strong> <span id="detalle-id"></span></li>
              <li class="list-group-item"><strong>Nombre:</strong> <span id="detalle-nombre"></span></li>
              <li class="list-group-item"><strong>Descripci√≥n:</strong> <span id="detalle-descripcion"></span></li>
              <li class="list-group-item"><strong>Precio:</strong> $<span id="detalle-precio"></span></li>
              <li class="list-group-item"><strong>Stock actual:</strong> <span id="detalle-stock"></span></li>
              <li class="list-group-item"><strong>Stock m√≠nimo ideal:</strong> <span id="detalle-stock_minimo"></span></li>
              <li class="list-group-item"><strong>Fecha creaci√≥n:</strong> <span id="detalle-fecha_creacion"></span></li>
              <li class="list-group-item"><strong>Fecha modificaci√≥n:</strong> <span id="detalle-fecha_modificacion"></span></li>
              <li class="list-group-item"><strong>Categor√≠a:</strong> <span id="detalle-categoria"></span></li>
              <li class="list-group-item"><strong>Proveedores:</strong> <span id="detalle-proveedores"></span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!--
      Script JS para llenar el modal con los datos del producto seleccionado.
      - Cuando el modal se va a mostrar (evento show.bs.modal),
        el script toma el bot√≥n que dispar√≥ el modal (event.relatedTarget).
      - Lee cada atributo data-* del bot√≥n y lo coloca en el <span> correspondiente del modal.
      - As√≠, el modal siempre muestra los datos correctos del producto seleccionado, sin recargar la p√°gina ni modificar la tabla.
    -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      var detalleModal = document.getElementById('detalleModal');
      detalleModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        // Llenar cada campo del modal con el atributo correspondiente del bot√≥n
        document.getElementById('detalle-id').textContent = button.getAttribute('data-id');
        document.getElementById('detalle-nombre').textContent = button.getAttribute('data-nombre');
        document.getElementById('detalle-descripcion').textContent = button.getAttribute('data-descripcion');
        document.getElementById('detalle-precio').textContent = button.getAttribute('data-precio');
        document.getElementById('detalle-stock').textContent = button.getAttribute('data-stock');
        document.getElementById('detalle-stock_minimo').textContent = button.getAttribute('data-stock_minimo');
        document.getElementById('detalle-fecha_creacion').textContent = button.getAttribute('data-fecha_creacion');
        document.getElementById('detalle-fecha_modificacion').textContent = button.getAttribute('data-fecha_modificacion');
        document.getElementById('detalle-categoria').textContent = button.getAttribute('data-categoria');
        document.getElementById('detalle-proveedores').textContent = button.getAttribute('data-proveedores') || 'Sin proveedores';
      });
    });
    </script>

    {% endblock content %}
</body>
</html>